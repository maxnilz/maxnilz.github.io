<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>




















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5"/>







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=6.7.0"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-128-128.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="maxnilz">
<meta property="og:url" content="https://maxnilz.github.io/index.html">
<meta property="og:site_name" content="maxnilz">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="maxnilz">






  <link rel="canonical" href="https://maxnilz.github.io/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>maxnilz</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">maxnilz</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br/>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/06/10/cloud-native-apps-with-grpc-and-istio/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/10/cloud-native-apps-with-grpc-and-istio/" class="post-title-link" itemprop="url">cloud-native-apps-with-grpc-and-istio</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-10 23:13:45 / 修改时间：23:45:20" itemprop="dateCreated datePublished" datetime="2019-06-10T23:13:45+08:00">2019-06-10</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>A simple web application that replaces keywords in user-entered text with emojis by communicating with a gRPC backend via gRPC-Web and Istio.<br>A simple hello world application that exposed a <code>/api/say</code> API gRPC backend via gRPC-json-transcoder and Istio.</p>
<p>Below is an outline of the steps we’ll follow to create the emoji application.</p>
<ol>
<li>Define the protocol format using Protobuf</li>
<li>Compile the Protobuf definition to generate Go and JavaScript files</li>
<li>Build and test a Go based gRPC service that replaces keywords in input text with emojis</li>
<li>Create a web interface for the emoji service using gRPC-Web</li>
<li>Configure the EnvoyFilter and deploy the backend over Istio</li>
<li>Deploy the web application and test our emoji service</li>
</ol>
<h2 id="The-Architecture"><a href="#The-Architecture" class="headerlink" title="The Architecture"></a>The Architecture</h2><p>Let’s dive a little deeper to understand what the final architecture for the emoji service will look like.</p>

<p>Simply put, the web application will leverage the gRPC-Web library to send HTTP requests to the Istio Gatway whenever the user supplies some text. The Istio Gateway will then route the HTTP request to the Proxy sidecar running alongside the emoji service backend, which will then translate the HTTP call to a gRPC call using Envoy’s gRPC-Web filter.</p>
<h2 id="Defining-The-Protocol-Format"><a href="#Defining-The-Protocol-Format" class="headerlink" title="Defining The Protocol Format"></a>Defining The Protocol Format</h2><p>First, let’s define the protocol format using Protobuf.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">package emoji;</span><br><span class="line"></span><br><span class="line">service EmojiService &#123;</span><br><span class="line">  rpc Emojize (EmojizeRequest) returns (EmojizeReply);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message EmojizeRequest &#123;</span><br><span class="line">  string text = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message EmojizeReply &#123;</span><br><span class="line">  string emojized_text = 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We define a simple service named EmojiService that understands a rpc call named Emojize which accepts an EmojizeRequest object and returns an instance of EmojizeReply.</p>
<p>The message named EmojizeRequest holds a string field named text to represent user-entered text. Also, EmojizeReply holds a string named emojized_text to represent the final output string wherein the server will have replaced known emoji keywords with an actual emoji character.</p>
<h2 id="Compiling-The-Protobuf-Definition"><a href="#Compiling-The-Protobuf-Definition" class="headerlink" title="Compiling The Protobuf Definition"></a>Compiling The Protobuf Definition</h2><p>Let’s first create the project directory structure like grpc-web-emoji/emoji/ and put the above definition in a file named emoji.proto.</p>
<p>We can now compile the emoji.proto file and generate the necessary Go files.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ protoc -I emoji/ emoji/emoji.proto --go_out=plugins=grpc:emoji</span><br></pre></td></tr></table></figure>
<p>Similarly, we also generate the JavaScript files.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ protoc -I emoji/ emoji/emoji.proto --js_out=import_style=commonjs:emoji \</span><br><span class="line">         --grpc-web_out=import_style=commonjs,mode=grpcwebtext:emoji</span><br></pre></td></tr></table></figure>
<p>At this point, you should land up with a directory structure like below.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">── grpc-web-emoji</span><br><span class="line">   └── emoji</span><br><span class="line">       ├── emoji.pb.go</span><br><span class="line">       ├── emoji.proto</span><br><span class="line">       ├── emoji_grpc_web_pb.js</span><br><span class="line">       └── emoji_pb.js</span><br></pre></td></tr></table></figure>
<h2 id="Building-And-Testing-The-Go-Backend"><a href="#Building-And-Testing-The-Go-Backend" class="headerlink" title="Building And Testing The Go Backend"></a>Building And Testing The Go Backend</h2><p>Let’s now create a go program that implements the EmojiService API. To do so, we create a file named main.go with the following contents.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;context&quot;</span><br><span class="line">	&quot;log&quot;</span><br><span class="line">	&quot;net&quot;</span><br><span class="line"></span><br><span class="line">	proto &quot;github.com/venilnoronha/grpc-web-emoji/emoji&quot;</span><br><span class="line">	&quot;google.golang.org/grpc&quot;</span><br><span class="line">	&quot;google.golang.org/grpc/reflection&quot;</span><br><span class="line">	emoji &quot;gopkg.in/kyokomi/emoji.v1&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// server is used to implement the EmojiService interface</span><br><span class="line">type server struct&#123;&#125;</span><br><span class="line"></span><br><span class="line">// Emojize takes a input string via EmojizeRequest, replaces known keywords with</span><br><span class="line">// actual emoji characters and returns it via a EmojizeReply instance.</span><br><span class="line">func (s *server) Emojize(c context.Context, r *proto.EmojizeRequest)</span><br><span class="line">			(*proto.EmojizeReply, error) &#123;</span><br><span class="line">	return &amp;proto.EmojizeReply&#123;EmojizedText: emoji.Sprint(r.Text)&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	// listen to TCP requests over port 9000</span><br><span class="line">	lis, err := net.Listen(&quot;tcp&quot;, &quot;:9000&quot;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatalf(&quot;failed to listen: %v&quot;, err)</span><br><span class="line">	&#125;</span><br><span class="line">	log.Printf(&quot;listening on %s&quot;, lis.Addr())</span><br><span class="line"></span><br><span class="line">	// register the EmojiService implementation with the gRPC server</span><br><span class="line">	s := grpc.NewServer()</span><br><span class="line">	proto.RegisterEmojiServiceServer(s, &amp;server&#123;&#125;)</span><br><span class="line">	reflection.Register(s)</span><br><span class="line">	if err := s.Serve(lis); err != nil &#123;</span><br><span class="line">		log.Fatalf(&quot;failed to serve: %v&quot;, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I’ve used the kyokomi/emoji library to do the heavy lifting i.e. converting keywords from input text into emojis.</p>
<p>Let’s start the server, like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run -v main.go</span><br><span class="line">2019/06/10 10:45:12 listening on [::]:9000</span><br></pre></td></tr></table></figure>
<p>It’s now time to test the emoji service programmatically. We’ll do so by creating a new client implementation named emoji_client.go with the following contents.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;log&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line"></span><br><span class="line">	proto &quot;github.com/venilnoronha/grpc-web-emoji/emoji&quot;</span><br><span class="line">	&quot;golang.org/x/net/context&quot;</span><br><span class="line">	&quot;google.golang.org/grpc&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	// connect to the server</span><br><span class="line">	conn, err := grpc.Dial(&quot;localhost:9000&quot;, grpc.WithInsecure())</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatalf(&quot;could not connect to the service: %v&quot;, err)</span><br><span class="line">	&#125;</span><br><span class="line">	defer conn.Close()</span><br><span class="line"></span><br><span class="line">	// send a request to the server</span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class="line">	defer cancel()</span><br><span class="line"></span><br><span class="line">	c := proto.NewEmojiServiceClient(conn)</span><br><span class="line">	resp, err := c.Emojize(ctx, &amp;proto.EmojizeRequest&#123;</span><br><span class="line">		Text: &quot;I like :pizza: and :sushi:!&quot;,</span><br><span class="line">	&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatalf(&quot;could not call service: %v&quot;, err)</span><br><span class="line">	&#125;</span><br><span class="line">	log.Printf(&quot;server says: %s&quot;, resp.GetEmojizedText())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can now run the emoji service client as shown below.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run emoji_client.go</span><br><span class="line">2019/06/10 10:55:52 server says: I like 🍕  and 🍣 !</span><br></pre></td></tr></table></figure>
<p>Voila! The gRPC emoji service works as expected, and it’s now time to get the web frontend up and running.</p>
<h2 id="Creating-The-Web-Interface-Using-gRPC-Web"><a href="#Creating-The-Web-Interface-Using-gRPC-Web" class="headerlink" title="Creating The Web Interface Using gRPC-Web"></a>Creating The Web Interface Using gRPC-Web</h2><p>First, let’s create a HTML page named index.html. The page displays a text editor to the user and calls a emojize function (which we’ll define later) to send the user-input to the backend emoji service. The emojize function will also consume the gRPC response from the backend service and update the user input field with the data given out by the server.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&quot;editor&quot; contentEditable=&quot;true&quot; hidefocus=&quot;true&quot; onkeyup=&quot;emojize()&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;script src=&quot;dist/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>Let’s put the JavaScript code for the web frontend in a file named client.js as shown below.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const &#123;EmojizeRequest, EmojizeReply&#125; = require(&apos;emoji/emoji_pb.js&apos;);</span><br><span class="line">const &#123;EmojiServiceClient&#125; = require(&apos;emoji/emoji_grpc_web_pb.js&apos;);</span><br><span class="line"></span><br><span class="line">var client = new EmojiServiceClient(&apos;http://192.168.99.100:31380&apos;);</span><br><span class="line">var editor = document.getElementById(&apos;editor&apos;);</span><br><span class="line"></span><br><span class="line">window.emojize = function() &#123;</span><br><span class="line">  var request = new EmojizeRequest();</span><br><span class="line">  request.setText(editor.innerText);</span><br><span class="line"></span><br><span class="line">  client.emojize(request, &#123;&#125;, (err, response) =&gt; &#123;</span><br><span class="line">    editor.innerText = response.getEmojizedText();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice that the EmojiServiceClient connects with the backend emoji service at <a href="http://192.168.99.100:31380" target="_blank" rel="noopener">http://192.168.99.100:31380</a> and not <a href="http://localhost:9000" target="_blank" rel="noopener">http://localhost:9000</a>. This is because the web application can’t directly speak with a gRPC backend, and, therefore, we’ll be deploying our backend emoji service over Istio. The Istio deployment will be running on Minikube with the IP address of 192.168.99.100 and the default Istio Ingress port exposed for HTTP is 31380.</p>
<p>We’ll now need a couple of libraries to generate the final dist/main.js which we reference in index.html. To do so, we use the following npm package.json configuration.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;grpc-web-emoji&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.1.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;gRPC-Web Emoji Sample&quot;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;@grpc/proto-loader&quot;: &quot;^0.3.0&quot;,</span><br><span class="line">    &quot;google-protobuf&quot;: &quot;^3.6.1&quot;,</span><br><span class="line">    &quot;grpc&quot;: &quot;^1.15.0&quot;,</span><br><span class="line">    &quot;grpc-web&quot;: &quot;^1.0.0&quot;,</span><br><span class="line">    &quot;webpack&quot;: &quot;^4.16.5&quot;,</span><br><span class="line">    &quot;webpack-cli&quot;: &quot;^3.1.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>At this point, we can install the libraries and generate dist/main.js using the following commands.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br><span class="line">$ npx webpack client.js</span><br></pre></td></tr></table></figure>
<h2 id="Deploying-The-Backend-Over-Istio"><a href="#Deploying-The-Backend-Over-Istio" class="headerlink" title="Deploying The Backend Over Istio"></a>Deploying The Backend Over Istio</h2><p>We can now package the backend emoji service into a container and deploy it over Istio. We’d need to install the gRPC-Web EnvoyFilter here so that calls to the backend gRPC service can be translated to/from gRPC and HTTP.</p>
<p>Let’s start off by building the Docker image with the following Dockerfile.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM golang:1.12 as builder</span><br><span class="line"></span><br><span class="line">WORKDIR /root/go/src/github.com/maxnilz/grpc-istio-demo/</span><br><span class="line">COPY ./ .</span><br><span class="line">RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -v -o bin/server ./cmd/server.go</span><br><span class="line"></span><br><span class="line">FROM scratch</span><br><span class="line">WORKDIR /bin/</span><br><span class="line">COPY --from=builder /root/go/src/github.com/maxnilz/grpc-istio-demo/bin/server .</span><br><span class="line">ENTRYPOINT [ &quot;/bin/server&quot; ]</span><br><span class="line">EXPOSE 9000</span><br></pre></td></tr></table></figure>
<p>We can build and push the image to Docker Hub like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --build-arg http_proxy=$(http_proxy) --build-arg https_proxy=$(http_proxy) --build-arg no_proxy=$(no_proxy) -f docker/server.Dockerfile -t maxnilz/grpc-istio-demo:server .</span><br><span class="line">$ docker push maxnilz/grpc-istio-demo:server</span><br></pre></td></tr></table></figure>
<p>Next, we define the Kubernetes Service and Deployment configuration as shown below. Let’s call this server.yaml.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: server</span><br><span class="line">  labels:</span><br><span class="line">    app: server</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: grpc-web</span><br><span class="line">    port: 9000</span><br><span class="line">  selector:</span><br><span class="line">    app: server</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: server</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: server</span><br><span class="line">        version: v1</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: server</span><br><span class="line">        image: maxnilz/grpc-istio-demo:server</span><br><span class="line">        imagePullPolicy: Always</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9000</span><br></pre></td></tr></table></figure>
<p>Note that once we deploy this service over Istio, the grpc- prefix in the Service port name will allow Istio to recognize this as a gRPC service.</p>
<p>Next, we need to define an Istio Gateway to route HTTP traffic over to the backend service. To do so, we write the following configuration to a file named gateway.yaml.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: networking.istio.io/v1alpha3</span><br><span class="line">kind: Gateway</span><br><span class="line">metadata:</span><br><span class="line">  name: gateway</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    istio: ingressgateway</span><br><span class="line">  servers:</span><br><span class="line">  - port:</span><br><span class="line">      number: 80</span><br><span class="line">      name: http</span><br><span class="line">      protocol: HTTP</span><br><span class="line">    hosts:</span><br><span class="line">    - &quot;*&quot;</span><br><span class="line">  - port:</span><br><span class="line">      number: 31400</span><br><span class="line">      name: grpc</span><br><span class="line">      protocol: HTTP</span><br><span class="line">    hosts:</span><br><span class="line">      - &quot;*&quot;</span><br><span class="line">---</span><br><span class="line">apiVersion: networking.istio.io/v1alpha3</span><br><span class="line">kind: VirtualService</span><br><span class="line">metadata:</span><br><span class="line">  name: virtual-service</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">    - &quot;*&quot;</span><br><span class="line">  gateways:</span><br><span class="line">  - gateway</span><br><span class="line">  http:</span><br><span class="line">  - match:</span><br><span class="line">    - uri:</span><br><span class="line">        prefix: /proto.EmojiService</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: server</span><br><span class="line">    corsPolicy:</span><br><span class="line">      allowOrigin:</span><br><span class="line">        - &quot;*&quot;</span><br><span class="line">      allowMethods:</span><br><span class="line">        - POST</span><br><span class="line">        - GET</span><br><span class="line">        - OPTIONS</span><br><span class="line">        - PUT</span><br><span class="line">        - DELETE</span><br><span class="line">      allowHeaders:</span><br><span class="line">        - grpc-timeout</span><br><span class="line">        - content-type</span><br><span class="line">        - keep-alive</span><br><span class="line">        - user-agent</span><br><span class="line">        - cache-control</span><br><span class="line">        - content-type</span><br><span class="line">        - content-transfer-encoding</span><br><span class="line">        - custom-header-1</span><br><span class="line">        - x-accept-content-transfer-encoding</span><br><span class="line">        - x-accept-response-streaming</span><br><span class="line">        - x-user-agent</span><br><span class="line">        - x-grpc-web</span><br><span class="line">      maxAge: 1728s</span><br><span class="line">      exposeHeaders:</span><br><span class="line">        - custom-header-1</span><br><span class="line">        - grpc-status</span><br><span class="line">        - grpc-message</span><br><span class="line">      allowCredentials: true</span><br><span class="line">  - match:</span><br><span class="line">    - uri:</span><br><span class="line">        prefix: /api</span><br><span class="line">    route:</span><br><span class="line">      - destination:</span><br><span class="line">          host: server</span><br><span class="line">  - match:</span><br><span class="line">    - port: 31400</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: server</span><br><span class="line">        port:</span><br><span class="line">          number: 9000</span><br><span class="line">  - route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: web-ui</span><br></pre></td></tr></table></figure>
<p>Notice that we’ve defined a complex corsPolicy here, and it’s required for gRPC-Web to work correctly.</p>
<p>Next, we define the Kubernetes Service and Deployment configuration as shown below. Let’s call this web-ui.yaml.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: web-ui</span><br><span class="line">  labels:</span><br><span class="line">    app: web-ui</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 9001</span><br><span class="line">  selector:</span><br><span class="line">    app: web-ui</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: web-ui</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: web-ui</span><br><span class="line">        version: v1</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: web-ui</span><br><span class="line">        image: maxnilz/grpc-istio-demo:web-ui</span><br><span class="line">        imagePullPolicy: Always</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9001</span><br></pre></td></tr></table></figure></p>
<p>We can now simply deploy the above configurations in the following order.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f &lt;(istioctl kube-inject -f istio/server.yaml)</span><br><span class="line">$ kubectl apply -f &lt;(istioctl kube-inject -f istio/web-ui.yaml)</span><br><span class="line">$ kubectl apply -f istio/gateway.yaml</span><br></pre></td></tr></table></figure></p>
<h2 id="Deploying-And-Testing-The-Web-Frontend"><a href="#Deploying-And-Testing-The-Web-Frontend" class="headerlink" title="Deploying And Testing The Web Frontend"></a>Deploying And Testing The Web Frontend</h2><p>We’ve now reached the final stage of the experiment. Let’s head over to <a href="http://192.168.99.100:31380" target="_blank" rel="noopener">http://192.168.99.100:31380</a> to play with the emoji web interface.</p>
<p>If everything went well, you should have a fully functional gRPC-Web based web application, as shown below.<br><img src="/2019/06/10/cloud-native-apps-with-grpc-and-istio/demo.gif" title="demo.gif"></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>gRPC-Web provides a great way of bringing the benefits of gRPC services over to web applications. It currently needs a middle agent like the Istio Data Plane (i.e. Envoy Proxy) in order to translate data to/from HTTP and gRPC formats. However, once we have the infrastructure ready, building web applications can become a seamless experience for developers when working with gRPC.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>The gRPC-Web <a href="https://github.com/grpc/grpc-web/tree/master/net/grpc/gateway/examples/helloworld" target="_blank" rel="noopener">Hello World Guide</a></li>
<li>The WebpageFx <a href="https://www.webpagefx.com/tools/emoji-cheat-sheet/" target="_blank" rel="noopener">Emoji Cheat Sheet</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/06/10/implementing-grpc-web-istio-envoy/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/10/implementing-grpc-web-istio-envoy/" class="post-title-link" itemprop="url">implementing-grpc-web-istio-envoy</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-10 22:51:55 / 修改时间：22:58:10" itemprop="dateCreated datePublished" datetime="2019-06-10T22:51:55+08:00">2019-06-10</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>This is a post which was about how web applications can benefit from gRPC by leveraging a gRPC sub-project called gRPC-Web along with Istio.</p>
<p>gRPC-Web addresses a shortcoming in the core gRPC framework: the fact that it doesn’t work so well with web applications running on browsers. That’s because even though most browsers support HTTP/2 and gRPC is based on HTTP/2, gRPC has its own protocols that web applications must understand in order to work properly with it. But web applications do not have this capability because browsers don’t support gRPC out of the box. Developers are increasingly looking to benefit from the advantages the core gRPC framework confers beyond backend microservices, thus gRPC-Web was born.</p>
<p>One way to get around the above problem is to use the gRPC-Web plugin and run a proxy like Envoy along with it. Envoy serves as the default proxy for Istio, and by configuring its gRPC-Web filter, we can create seamless, well-connected, cloud native web applications. Traditionally, services have exposed their functionality over REST APIs. This gives you service isolation, scalability, velocity and independence. But the REST API itself is not type safe; it doesn’t give you forward and backward compatibility and performance can be constrained.</p>
<p>Protobufs let us define the same API in a standard way with an interface definition language (IDL), which resolves the issues that REST APIs aren’t addressing. Replace the REST API in services with gRPC and the backend works pretty much the same as before. That doesn’t totally solve the problem though (i.e. the web UI still cannot talk to backend services because browsers don’t directly support gRPC). You get around that by using the gRPC-Web library and a proxy. With those in place, web applications can now talk to a gRPC backend directly.</p>
<p>Another alternative is to use an HTTP server pattern, where you implement some kind of an intermediate middleware that takes simple HTTP requests from the browser and converts them to gRPC. But that won’t scale because you need to keep updating the API, and it’s not maintainable when you have a lot of microservices and need to create these kinds of APIs for every single microservice. Use a proxy-based approach built around a service mesh framework and it will transcode your HTTP requests into gRPC requests so you can get rid of the HTTP server.</p>
<p>In my talk, I showed a demo of a web app that uses gRPC-Web on the front end and a simple Go backend exposing a gRPC API. I didn’t configure a proxy directly but instead deployed the application on Istio, which configured the proxy and the gRPC-Web filter automatically. Crucially, the front and backend are now talking seamlessly, and you also gain a whole set of features from Istio as well.</p>
<p>One of the most important of these is observability. You can now observe your microservices on the Grafana dashboard that shows key metrics like client and server request volumes, success rates, request durations and response rates. Then, because you are working with Istio, you can also trace all HTTP and gRPC requests in a much more standard manner using Jaeger. Apart from these, Kiali lets you visualize your deployment as a service graph which it generates by observing the traffic flow in real-time.</p>
<p>The bottom line here is that by switching over to a gRPC-Web and Istio paradigm, developing a cloud native application becomes a relatively seamless experience.</p>
<p>People seemed interested in the approach I was outlining and were curious to know how it might work in production. The demo is the result of very recent research, so it’s all I had at the moment – but if you would like to give it a go in production and let us know how it works, please go ahead! You can find the <a href="https://github.com/maxnilz/grpc-istio-demo" target="_blank" rel="noopener">demo on GitHub</a>. Feel free to check out the code and deploy the demo on Istio to see how it performs.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/05/13/c10K-c100K/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/13/c10K-c100K/" class="post-title-link" itemprop="url">c10K-c1M-c10M</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-13 07:31:43 / 修改时间：08:30:58" itemprop="dateCreated datePublished" datetime="2019-05-13T07:31:43+08:00">2019-05-13</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>C10K、C100K, C1000K=C1M,C10M( concurrent 10M connections)….千万级并发实现的秘密：内核不是解决方案，而是问题所在！</p>
<h2 id="defination"><a href="#defination" class="headerlink" title="defination"></a>defination</h2><p>The C10k problem is the problem of optimising network sockets to handle a large number of clients at the same time.[1] The name C10k is a numeronym for concurrently handling ten thousand connections.[2] <em>Note that concurrent connections are not the same as requests per second, though they are similar: handling many requests per second requires high throughput (processing them quickly), while high number of concurrent connections requires efficient scheduling of connections</em>. <em>In other words, handling many requests per second is concerned with the speed of handling requests, whereas a system capable of handling a high number of concurrent connections does not necessarily have to be a fast system, only one where each request will deterministically return a response within a (not necessarily fixed) finite amount of time</em>.</p>
<p>The problem of socket server optimisation has been studied because a number of factors must be considered to allow a web server to support many clients. This can involve a combination of operating system constraints and web server software limitations. According to the scope of services to be made available and the capabilities of the operating system as well as hardware considerations such as multi-processing capabilities, a multi-threading model or a single threading model can be preferred. Concurrently with this aspect, which involves considerations regarding memory management (usually operating system related), strategies implied relate to the very diverse aspects of the I/O management.[2]</p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ul>
<li>The C10K problem:  <a href="http://www.kegel.com/c10k.html" target="_blank" rel="noopener">http://www.kegel.com/c10k.html</a></li>
<li>C1M: <a href="http://www.blogjava.net/yongboy/category/54842.html" target="_blank" rel="noopener">http://www.blogjava.net/yongboy/category/54842.html</a></li>
<li>从C10K到C10M高性能网络的探索与实践: <a href="http://blog.qiniu.com/archives/4941" target="_blank" rel="noopener">http://blog.qiniu.com/archives/4941</a></li>
<li>C10M问题<ul>
<li><a href="http://www.lenky.info/archives/2013/07/2320?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noopener">http://www.lenky.info/archives/2013/07/2320?utm_source=tuicool&amp;utm_medium=referral</a> </li>
<li><a href="http://c10m.robertgraham.com/p/blog-page.html" target="_blank" rel="noopener">http://c10m.robertgraham.com/p/blog-page.html</a></li>
<li><a href="http://highscalability.com/blog/2013/5/13/the-secret-to-10-million-concurrent-connections-the-kernel-i.html" target="_blank" rel="noopener">http://highscalability.com/blog/2013/5/13/the-secret-to-10-million-concurrent-connections-the-kernel-i.html</a></li>
<li><a href="http://www.csdn.net/article/2013-05-16/2815317-The-Secret-to-10M-Concurrent-Connections" target="_blank" rel="noopener">http://www.csdn.net/article/2013-05-16/2815317-The-Secret-to-10M-Concurrent-Connections</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/05/08/micro-services-arch-basics/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/08/micro-services-arch-basics/" class="post-title-link" itemprop="url">micro-services-arch-basics</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-08 07:48:21" itemprop="dateCreated datePublished" datetime="2019-05-08T07:48:21+08:00">2019-05-08</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/05/07/protobuf-based-database/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/07/protobuf-based-database/" class="post-title-link" itemprop="url">protobuf-based-database</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-07 21:33:41" itemprop="dateCreated datePublished" datetime="2019-05-07T21:33:41+08:00">2019-05-07</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/05/07/golang-concurency-model/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/07/golang-concurency-model/" class="post-title-link" itemprop="url">golang-concurency-model</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-07 21:26:12" itemprop="dateCreated datePublished" datetime="2019-05-07T21:26:12+08:00">2019-05-07</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/04/09/dubbo-basic/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/09/dubbo-basic/" class="post-title-link" itemprop="url">dubbo-basic</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-09 08:00:57" itemprop="dateCreated datePublished" datetime="2019-04-09T08:00:57+08:00">2019-04-09</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/04/09/legacy-transaction/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/09/legacy-transaction/" class="post-title-link" itemprop="url">数据库事务之基础概念</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-09 07:54:52" itemprop="dateCreated datePublished" datetime="2019-04-09T07:54:52+08:00">2019-04-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-07 21:33:57" itemprop="dateModified" datetime="2019-05-07T21:33:57+08:00">2019-05-07</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>数据库事务：在数据库系统里的一个逻辑执行单元，单个事务的执行应该是连续、可靠、并且独立于其它事务的。 一般来说数据库系统中的任何数据变更都可以称之为事务，事务在数据库系统中主要有两个目的：</p>
<ol>
<li>提供可靠的逻辑处理单元，允许数据库系统自身或者宿主机操作系统出现故障以及数据库系统的某些操作尚未执行完毕（部分执行），或者存在未知状态时能够正确的恢复数据并且保证数据的一致性。</li>
<li>提供隔离机制，使得不同的数据操作能够并发的执行，且相互不受干扰。</li>
</ol>
<p>在数据库系统中，一个事务是由一个或者多个数据操作组成的单个逻辑执行单元。 比如一个从银行账户转账到另一个银行账户，可以看做是由以下两个操作组成的一个事务：</p>
<ol>
<li>从转出账户扣款。</li>
<li>给转入账户加上相应数额的钱款。</li>
</ol>
<p>数据库事务必须同时满足：atomic, consistent, isolated and durable. 这四个属性其实就是我们常说的<code>ACID</code>。</p>
<p>数据库事务包含了”all-or-nothing”语意，具体来说就是，每一个数据库事务的执行逻辑必须是事务内的所有操作要么全部执行，要么一个也不执行。 更进一步，系统同时必须保证不同的事务执行单元之间是相互隔离、独自运行的，并且执行结果不会违背数据库中存在的（定义好的）约束（constraints），执行成功的事务必须要存储到可以持久保存的存储介质中去。</p>
<h2 id="事务的目的"><a href="#事务的目的" class="headerlink" title="事务的目的"></a>事务的目的</h2><p>数据库和其它的数据存储系统认为保证数据的完整性非常重要</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/04/09/etcd-storage/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/09/etcd-storage/" class="post-title-link" itemprop="url">etcd-storage</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-09 07:50:53" itemprop="dateCreated datePublished" datetime="2019-04-09T07:50:53+08:00">2019-04-09</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://maxnilz.github.io/2019/03/25/redis-ha/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maxnilz"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.PNG"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maxnilz"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/25/redis-ha/" class="post-title-link" itemprop="url">redis-ha</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-25 13:26:37" itemprop="dateCreated datePublished" datetime="2019-03-25T13:26:37+08:00">2019-03-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-05 10:01:28" itemprop="dateModified" datetime="2019-04-05T10:01:28+08:00">2019-04-05</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.PNG"
                alt="maxnilz"/>
            
              <p class="site-author-name" itemprop="name">maxnilz</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/maxnilz" title="GitHub &rarr; https://github.com/maxnilz" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:yuxianchao@hotmail.com" title="E-Mail &rarr; mailto:yuxianchao@hotmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maxnilz</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  




  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
